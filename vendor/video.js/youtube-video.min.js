let ensurePathArray=function(paths){if(!paths){paths=[]}else if(typeof paths==="string"){paths=[paths]}return paths};class ResourceManager{constructor(){this._head=document.getElementsByTagName("head")[0];this._cssPaths={};this._scriptMaps={};this._dataPromises={}}async loadScript(paths){let script,map,loadPromises=[];paths=ensurePathArray(paths);paths.forEach(path=>{map=this._scriptMaps[path]=this._scriptMaps[path]||{};if(!map.promise){map.path=path;map.promise=new Promise(resolve=>{script=this.createScriptElement();script.setAttribute("type","text/javascript");script.src=path;script.addEventListener("load",resolve);this._head.appendChild(script)})}loadPromises.push(map.promise)});return Promise.all(loadPromises)}async unloadScript(paths){let file;return new Promise(resolve=>{paths=ensurePathArray(paths);paths.forEach(path=>{file=this._head.querySelectorAll('script[src="'+path+'"]')[0];if(file){this._head.removeChild(file);delete this._scriptMaps[path]}});resolve()})}createScriptElement(){return document.createElement("script")}async fetchData(url,reqOptions={}){let cacheId=url+JSON.stringify(reqOptions);reqOptions.cache=reqOptions.cache===undefined?true:reqOptions.cache;if(!url){return Promise.resolve()}if(!this._dataPromises[cacheId]||!reqOptions.cache){try{this._dataPromises[cacheId]=await fetch(url,reqOptions)}catch(e){this._dataPromises[cacheId]=null;throw e}}return this._dataPromises[cacheId]}async loadCss(paths){return new Promise(resolve=>{paths=ensurePathArray(paths);paths.forEach(path=>{if(!this._cssPaths[path]){let el=document.createElement("link");el.setAttribute("rel","stylesheet");el.setAttribute("href",path);this._head.appendChild(el);this._cssPaths[path]=el}});resolve()})}async unloadCss(paths){let el;return new Promise(resolve=>{paths=ensurePathArray(paths);paths.forEach(path=>{el=this._cssPaths[path];if(el){this._head.removeChild(el);this._cssPaths[path]=null}});resolve()})}async loadTemplate(path,el){if(!path){return Promise.resolve()}const contents=await this.fetchTemplate(path);if(el){el.innerHTML=contents;return el}return contents}async fetchTemplate(templatePath){const resp=await fetch(templatePath);return await resp.text()}async flush(){await this.unloadCss(Object.getOwnPropertyNames(this._cssPaths));this._cssPaths={};for(let s in this._scriptMaps){if(this._scriptMaps.hasOwnProperty(s)){let map=this._scriptMaps[s];await this.unloadScript(map.path)}}this._scriptMaps={};this._dataPromises={}}}const resourceManager=new ResourceManager;function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments)).next())})}const videos=new Map;class YoutubeVideoElement extends HTMLElement{constructor(){super();this.paused=true;this.ytPlayerContainer=undefined;this.resolveBuildPlayerPromise=null;this.ytPlayerPromise=null;this.scriptPath="https://www.youtube.com/iframe_api";this.mediaError=undefined;videos.set(this,this.id)}connectedCallback(){this.ytPlayerContainer=this.createYTPlayerElement();this.appendChild(this.ytPlayerContainer);this.ytPlayerContainer.style.display="block";this.load()}disconnectedCallback(){videos.delete(this);if(this.resolveBuildPlayerPromise){this.resolveBuildPlayerPromise()}if(this.ytPlayer){this.ytPlayer.destroy()}if(!videos.size){videos.clear();this.unloadYTScript()}}get height(){return Number(this.getAttribute("height"))}get width(){return Number(this.getAttribute("width"))}get src(){return this.getAttribute("src")}get autoplay(){return Boolean(this.getAttribute("autoplay"))}get id(){return this.getAttribute("id")||`ytPlayer-${videos.size}`}get controls(){return Boolean(this.getAttribute("controls"))}get ytPlayerVars(){const{srcQueryParams:srcQueryParams}=this;srcQueryParams.autoplay=this.autoplay?1:0;srcQueryParams.controls=this.controls?1:0;return srcQueryParams}get srcQueryParams(){const queryString=this.src.split("?")[1]||"";if(!queryString){return{}}const a=queryString.split("&");const params={};for(const item of a){const p=item.split("=",2);if(p.length===1){params[p[0]]=""}else{params[p[0]]=decodeURIComponent(p[1].replace(/\+/g," "))}}return params}load(){return __awaiter(this,void 0,Promise,function*(){yield this.loadYTScript();this.ytPlayer=yield this.buildPlayer();return this.ytPlayer})}get videoId(){const re=new RegExp(`https?:\\/\\/(?:[0-9A-Z-]+\\.)?(?:youtu\\.be\\/|youtube(?:-nocookie)?\\.com\\S*[^\\w\\s-])([\\w-]{11})(?=[^\\w-]|$)(?![?=&+%\\w.-]*(?:['"][^<>]*>|<\\/a>))[?=&+%\\w.-]*`,"ig");return this.src.replace(re,"$1")}play(){this.paused=false;if(!this.src){this.error=new Error(`you cannot call play() method on a video element that has no youtube source url`)}else if(this.ytPlayer){this.ytPlayer.playVideo()}}pause(){if(this.ytPlayer){this.ytPlayer.pauseVideo()}}createYTPlayerElement(){return document.createElement("div")}onPlay(){this.paused=false;videos.forEach((id,video)=>{if(video!==this&&!video.paused){video.pause()}});this.dispatchEvent(new CustomEvent("play"))}onPause(){this.paused=true}onEnd(){this.paused=true}set error(error){const{message:message}=error;this.dispatchEvent(new ErrorEvent(message));this.mediaError=error;throw error}get error(){return this.mediaError}_onYTApiStateChange(obj){const stateMap={"-1":"unstarted",0:"ended",1:"playing",2:"pause",3:"buffering",5:"cued"};const state=stateMap[obj.data.toString()];const eventMethodMap={ended:this.onEnd,pause:this.onPause,playing:this.onPlay};if(eventMethodMap[state]){const method=eventMethodMap[state];if(method){method.call(this);this.dispatchEvent(new CustomEvent(state))}}}loadYTScript(){if(!YoutubeVideoElement.scriptLoadPromise){YoutubeVideoElement.scriptLoadPromise=new Promise(resolve=>{if(!window.onYouTubeIframeAPIReady){YoutubeVideoElement.triggerYoutubeIframeAPIReady=resolve;window.onYouTubeIframeAPIReady=(()=>{window.onYouTubeIframeAPIReady=null;YoutubeVideoElement.triggerYoutubeIframeAPIReady()})}return resourceManager.loadScript(this.scriptPath)})}return YoutubeVideoElement.scriptLoadPromise}unloadYTScript(){resourceManager.unloadScript(this.scriptPath);YoutubeVideoElement.scriptLoadPromise=null}buildPlayer(){if(this.ytPlayerPromise){return this.ytPlayerPromise}this.ytPlayerPromise=new Promise(resolve=>{const playerOptions={events:{onError:e=>{this.error=new Error("player could not be built")},onReady:e=>{this.dispatchEvent(new CustomEvent("loadstart"));this.dispatchEvent(new CustomEvent("canplay"));this.resolveBuildPlayerPromise=resolve;resolve(e.target)},onStateChange:obj=>this._onYTApiStateChange(obj)},height:this.height,playerVars:this.ytPlayerVars,videoId:this.videoId,width:this.width};this.ytPlayer=new YT.Player(this.ytPlayerContainer,playerOptions)});return this.ytPlayerPromise}}YoutubeVideoElement.scriptLoadPromise=null;YoutubeVideoElement.triggerYoutubeIframeAPIReady=null;customElements.define("youtube-video",YoutubeVideoElement);export{YoutubeVideoElement};